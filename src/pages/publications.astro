---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const translations = {
	subtitle: { en: 'Full Publication List', es: 'Trabajos Seleccionados' },
	title: { en: 'Publications', es: 'Proyectos' },
	description: { en: 'A complete list of my publications, preprints, and research outputs.', es: 'Una colección de proyectos que muestran mis habilidades en desarrollo full-stack, desde la concepción hasta el despliegue.' },
	comingSoon: { en: 'Publications are coming', es: 'Los proyectos están por venir' },
	noPubs: { en: 'No publications yet.', es: 'Aún no hay publicaciones.' }
};

const MY_NAME_VARIANTS = [
  'Jiyoon Pyo',
  'Pyo, Jiyoon',
  'J. Pyo',
  'Jiyoon P.'
];

function normalizeName(s) {
  return String(s)
    .toLowerCase()
    .replace(/[\u2019\u2018]/g, "'")
    .replace(/[^a-z\s,\.\-]/g, '')
    .replace(/\s+/g, ' ')
    .trim();
}

function canonicalizeCommaName(s) {
  const t = String(s).trim();
  if (t.includes(',')) {
    const [last, first] = t.split(',').map((x) => x.trim());
    if (first && last) return `${first} ${last}`;
  }
  return t;
}

function isMe(author) {
  const a = normalizeName(canonicalizeCommaName(author));
  return MY_NAME_VARIANTS.some((v) => normalizeName(canonicalizeCommaName(v)) === a);
}

function splitAuthors(authors) {
  if (Array.isArray(authors)) return authors;
  const s = String(authors || '').trim();
  if (!s) return [];
  if (s.includes(';')) return s.split(';').map((x) => x.trim()).filter(Boolean);
  return s.split(',').map((x) => x.trim()).filter(Boolean);
}

const publications = [
	{
		title: '1',
		authors: 'Jiyoon Pyo, Second Author, Third Author',
		venue: 'Preprint',
		year: 2025,
		links: {
			paper: 'https://arxiv.org/abs/xxxx.xxxxx',
			webpage: 'https://example.com',
			github: 'https://github.com/org/repo',
			huggingface: 'https://huggingface.co/org/model',
			bibtex: '/bib/fer.bib'
		}
	},
	{
		title: '2',
		authors: 'Jiyoon Pyo, Second Author, Third Author',
		venue: 'Preprint',
		year: 2024,
		links: {
			paper: 'https://arxiv.org/abs/xxxx.xxxxx',
			webpage: 'https://example.com',
			github: 'https://github.com/org/repo',
			huggingface: 'https://huggingface.co/org/model',
			bibtex: '/bib/fer.bib'
		}
	}
]

const pubsSorted = [...publications].sort((a, b) => (b.year ?? 0) - (a.year ?? 0));

function actionButtons(links) {
	if (!links) return [];
	const btns = [];
	if (links.paper) btns.push({ label: 'Paper', href: links.paper });
	if (links.webpage) btns.push({ label: 'Webpage', href: links.webpage });
	if (links.github) btns.push({ label: 'GitHub', href: links.github });
	if (links.huggingface) btns.push({ label: 'Hugging Face', href: links.huggingface });
	if (links.bibtex) btns.push({ label: 'BibTeX', href: links.bibtex });
	return btns;
}
---

<Layout title={`Publications | Jiyoon Pyo`}>
	<Header />
	
	<main class="min-h-screen px-4 sm:px-6 md:px-6">
		<section class="max-w-3xl mx-auto min-h-[calc(100vh-5rem)] pt-24 sm:pt-32 md:pt-48 pb-16 sm:pb-24 fade-in px-2 sm:px-0">
			<div class="max-w-2xl mb-12 sm:mb-16">
				<p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 mb-3 sm:mb-4 tracking-wider uppercase" data-en={translations.subtitle.en} data-es={translations.subtitle.es}>{translations.subtitle.en}</p>
				<h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900 dark:text-white" data-en={translations.title.en} data-es={translations.title.es}>
					{translations.title.en}
				</h1>
				<p class="mt-3 sm:mt-4 text-sm sm:text-lg text-gray-600 dark:text-gray-400" data-en={translations.description.en} data-es={translations.description.es}>
					{translations.description.en}
				</p>
			</div>

			<!-- <div class="flex items-center justify-center min-h-[400px] parallax-section">
				<div class="text-center">
					<h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-white animate-pulse" data-en={translations.comingSoon.en} data-es={translations.comingSoon.es}>
						{translations.comingSoon.en}
					</h2>
				</div>
			</div> -->

			{pubsSorted.length === 0 ? (
				<div class="text-gray-600 dark:text-gray-400 text-sm sm:text-base">{translations.noPubs.en}</div>
			  ) : (
				<div class="space-y-10">
				  {pubsSorted.map((p) => {
					const authors = splitAuthors(p.authors);
					const btns = actionButtons(p.links);
		
					return (
					  <article class="pb-10 border-b border-gray-200 dark:border-gray-800">
						<h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white leading-snug">
						  {p.title}
						</h3>
		
						<p class="mt-2 text-sm sm:text-base text-gray-700 dark:text-gray-300">
						  {authors.map((a, idx) => (
							<>
							  {idx > 0 ? ', ' : ''}
							  {isMe(a) ? <strong class="font-semibold">{a}</strong> : <span>{a}</span>}
							</>
						  ))}
						</p>
		
						{p.venue ? (
						  <p class="mt-1 text-sm italic text-gray-600 dark:text-gray-400">{p.venue}</p>
						) : null}
		
						{btns.length ? (
						  <div class="mt-3 flex flex-wrap gap-2">
							{btns.map((b) => (
							  <a
								href={b.href}
								target="_blank"
								rel="noreferrer"
								class="animated-border cursor-pointer px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white font-medium rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
							  >
								{b.label}
							  </a>
							))}
						  </div>
						) : null}
					  </article>
					);
				  })}
				</div>
			)}
		</section>
	</main>

	<Footer />

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const observerOptions = {
				root: null,
				rootMargin: '0px',
				threshold: 0.1
			};

			const observer = new IntersectionObserver((entries) => {
				entries.forEach(entry => {
					if (entry.isIntersecting) {
						entry.target.classList.add('visible');
					}
				});
			}, observerOptions);

			document.querySelectorAll('.fade-in').forEach(el => {
				observer.observe(el);
			});

			window.addEventListener('scroll', () => {
				const scrolled = window.pageYOffset;
				document.querySelectorAll('.parallax-section').forEach(section => {
					const speed = 0.05;
					(section as HTMLElement).style.transform = `translateY(${scrolled * speed}px)`;
				});
			});
		});
	</script>
</Layout>
